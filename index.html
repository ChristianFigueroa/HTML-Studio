<!DOCTYPE html>
<html lang='en-US'>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>HTML Studio &#183; ChristianFigueroa.GitHub.io</title>
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:600' rel='stylesheet' type='text/css'>
	<style type="text/css">
		@font-face {
			font-family: 'BPreplay';
			font-style: italic;
			font-weight: 700;
			src: local('BPreplay Bold Italic'),,
				 local('BPreplay-BoldItalic')
				 url('/assets/BPreplay-BoldItalics.woff2') format('woff2'),
				 url('/assets/BPreplay-BoldItalics.woff') format('woff'),
				 url('/assets/BPreplay-BoldItalics.ttf') format('truetype');
		}

		body, html {
			margin: 0;
			height: 100%;
			position: relative;
			overflow-y: hidden;
		}

		#measurementReference {
			height: 1rem;
			width: 1pt;
			visibility: hidden;
			pointer-events: none;
			position: absolute;
			top: -1rem;
			left: -1pt;
		}
		.contextmenuitem {
			background: #F2F2F2;
			font-family: Arial,Calibri, Sego UI, Arial, sans-serif;
		}

		.contextmenu {
			padding: .2em 0;
			background-color: #F2F2F2;
			border: 1px solid #DDD;
			box-shadow: .2rem .2rem .4rem 0 rgba(80,80,80,.8);
		}

		.contextmenu:not(.subcontextmenu) {
			font-size: 88%;
		}

		#framecontainer {
			min-height: 80%;
			width: auto;
			position: relative;
			overflow-y: auto;
		}

		#framecontainer > * {
			min-height: 100%;
			width: 100%;
			position: absolute;
			top: 0;
			left: 0;
		}

		#frameback {
			background: #90A4AE;
			background-image: url("svg/back.svg");
			background-size: contain;
		}

		#frame {
			border: 0;
			overflow-y: hidden;
		}

		#frameoverlay {
			overflow: hidden;
		}

		#overlaygrid {
			pointer-events: none;
			background: url("svg/grid.svg");
			background-size: contain;
			opacity: .4;
			display: none;
		}

		#toolbarcontainer {
			height: calc(20% - 1px);
			background: #F0F0F0;
			border-bottom: 1px solid #888;
			z-index: 1;
			position: relative;
			box-shadow: 0 2px 3px 3px rgba(0,0,0,.18);
		}

		#headersectionbar {
			padding-left: 8%;
			font-size: 0;
			position: absolute;
			top: calc(1% + 2.2rem);
		}

		.headersection {
			display: inline-block;
			font-family: Arial, sans-serif;
			padding: .3em .55em;
			vertical-align: top;
			cursor: default;
			position: relative;
			font-size: initial;
		}

		.headersection:hover {
			background: #DDD;
		}

		#titlebar {
			text-align: center;
			position: absolute;
			width: 100%;
			font-family: Arial, sans-serif;
			margin-top: .5%;
		}

		#title {
			min-width: 20%;
			max-width: 85%;
			display: inline-block;
			font-size: 1.2rem;
			background: #F0F0F0;
			border: 0;
			text-align: center;
			font-family: Arial, sans-serif;
			padding: .05rem 0;
		}

		#title:hover, #title:focus {
			background: #FFF;
			box-shadow: 0 0 5px 2px rgba(0,172,193,.4);
			border: 1px solid #00acc1;
			margin: -1px;
		}

		#titlewidth {
			display: inline;
			position: absolute;
			visibility: hidden;
			pointer-events: none;
			max-width: 85%;
			left: 0;
			font-size: 1.2rem;
		}

		.placeholder {
			color: rgba(0,0,0,.38);
			font-style: italic;
		}

		#logo {
			height: 100%;
			display: inline-block;
			width: 7%;
			background: #00acc1;
		}

		#tooltip {
			background: #F2F2F2;
			width: 50%;
			height: 8vh;
			position: absolute;
			top: 90%;
			left: 25%;
			box-shadow: .3rem .3rem .6rem 0 rgba(0,0,0,.6);
			border: 1px solid #CCC;
			margin: -1px;
			border-radius: 20vh 8vh 8vh 20vh;
		}

		#tooltip_icon {
			height: 6vh;
			width: 6vh;
			border-radius: 50%;
			background: url("svg/tooltip_icon.svg");
			box-shadow: 0 0 3px 1.5px rgba(0,0,0,.3);
			background-size: contain;
			top: 1vh;
			left: 1vh;
			position: absolute;
		}

		#tooltipinner {
			padding-left: 8vh;
			height: 100%;
			width: auto;
		}

		#tooltiptextcont {
			width: 100%;
			height: 100%;
			display: table;
		}

		#tooltiptext {
			display: table-cell;
			vertical-align: middle;
			text-align: center;
			font-family: Arial, sans-serif;
		}

		#open_file {
			display: none;
		}

		#dialogcover {
			z-index: 500;
			background: rgba(0,0,0,.7);
			height: 100vh;
			width: 100vw;
			position: absolute;
			display: none;
			top: 0;
			left: 0;
		}

		.dialog { 
			width: 50%;
			height: 75vh;
			background: #F0F0F0;
			text-align: center;
			border-radius: .6em;
			margin-left: calc(25% - 1px);
			margin-top: calc(12.5vh - 1px);
			border: 1px solid #AAA;
			box-shadow: .3rem .3rem 5px 4px rgba(0,0,0,.5);
			font-family: Arial, sans-serif;
			position: relative;
			display: none;
		}

		.dialog>span {
			font-size: 1.1em;
			display: block;
			margin: .2em 0;
		}

		.dialog>.content {
			height: calc(75vh - 5.9em - 1px);
			width: calc(100% - 4.5em);
			position: relative;
			left: .5em;
			border-radius: inherit;
			background: #FFF;
			border: 1px solid #AAA;
			margin: -1px -1px .5em;
			padding: .75em 1.75em;
			overflow: auto;
		}

		.dialog>.exit {
			height: 1.2em;
			width: 1.2em;
			position: absolute;
			top: .26em;
			right: .5em;
			background: rgba(0, 0, 0, 0) url("svg/exit.svg") 50% 50%/70% 70% no-repeat;
			border: 1px solid #AAA;
			margin: -1px;
			border-radius: .3em;
			cursor: pointer;
		}

		.dialog>.exit.disabled {
			background: #F0F0F0;
			cursor: default;
		}

		.dialog>.option {
			background: #FFF;
			display: inline-block;
			padding: .3em .5em;
			font-family: Arial, sans-serif;
			float: right;
			border-radius: .3em;
			border: 1px solid #AAA;
			margin: -1px .5em -1px -1px;
			cursor: pointer;
			position: static;
			width: initial;
		}

		.dialog>.option:hover {
			background: linear-gradient(to bottom, #EEE 0%,#CCC 100%);
		}

		.dialog>.option:active {
			background: linear-gradient(to bottom, #BBB 0%,#DDD 100%);
			box-shadow: 0 0 5px 2px rgba(0,0,0,.2) inset;
		}

		.dialog>.option.disabled {
			background: #F0F0F0;
			color: #999;
			box-shadow: initial;
			cursor: default;
		}

		.dialog>.content h3 {
			font-weight: normal;
			font-family: Arial, sans-serif;
			margin: 0;
		}

		#id1 {
			width: calc(100% - 2em);
			height: 40vh;
			background: #FFF;
			border: 1em dashed #00acc1;
			display: table;
			table-layout: fixed;
			margin-bottom: .75em;
		}

		#id1.active {
			border-color: #008ca1;
		}

		#id2 {
			margin-top: 2.5em;
			cursor: pointer;
		}

		#id3 {
			font-size: 10vh;
			display: block;
		}

		#id5 {
			font-size: 7vh;
			font-family: "BPreplay", Arial, sans-serif;
			font-style: italic;
			font-weight: 700;
		}

		#id4 {
			height: 100%;
			width: 100%;
			vertical-align: middle;
			display: table-cell;
			color: #00acc1;
			font-family: "BPreplay", Arial, sans-serif;
			font-style: italic;
			font-weight: 700;
			pointer-events: none;
		}

		#id6 {
			font-family: Arial, sans-serif;
			height: 100%;
			text-align: left;
			font-style: normal;
			font-weight: normal;
		}

		#id7 {
			font-family: "Open Sans", Arial, sans-serif;
			font-weight: normal;
			padding: 2.5vh;
			font-size: 3.5vh;
			color: #000;
			font-weight: 600;
			border: 1vh solid #FFF;
			border-radius: 3vh;
		}

		#id8 {
			font-size: 5vh;
			color:#00acc1;
			font-family: "BPreplay", Arial, sans-serif;
			font-weight: 700;
			font-style: italic;
			display: block;
			margin: 5vh 1em;
			line-height: 1.3;
			text-align: center;
		}

		#ide {
			padding: 0;
			height: calc(75vh - 4.4em - 1px);
			width: calc(100% - 1em);
		}

		#idf {
			height: calc(75vh - 6.9em - 1px);
			width: calc(100% - 3.5em);
			margin: 0;
			padding: .75em 1.75em;
			border: 0;
			resize: none;
		}

		#id1.active #id4 {
			color: #008ca1;
		}
	</style>
</head>
<body>
	<div id='measurementReference'></div>
	<div id='toolbarcontainer'>
		<div id='titlebar'>
			<input type='text' id='title' placeholder='Untitled HTML Document' title='Click to edit'>
			<div id='titlewidth'></div>
		</div>
		<div id='headersectionbar'>
			<div class='headersection' id='section_file'>File</div>
			<div class='headersection' id='section_edit'>Edit</div>
			<div class='headersection' id='section_view'>View</div>
		</div>
		<div id='logo'></div>
	</div>
	<div id='framecontainer'>
		<div id='frameback'></div>
		<iframe id='frame'></iframe>
		<div id='frameoverlay'></div>
		<div id='overlaygrid'></div>
	</div>
	<div id='tooltip'>
		<div id='tooltip_icon'></div>
		<div id='tooltipinner'>
			<div id='tooltiptextcont'>
				<div id='tooltiptext'>Extra information will appear here</div>
			</div>
		</div>
	</div>
	<div id='dialogcover'>
		<div id='dialog_open_file' class='dialog'>
			<span>Open File</span>
			<div class='content' id='idb'>
				<h3>Select a file to replace the current document. Keep in mind <strong style='text-decoration:underline'>this action cannot be undone</strong> and any unsaved changes will be deleted.</h3>
				<form id='id2'>
					<div id='id1' ondragover='return this.className="active",false' ondragend='return this.className="",false' ondragleave='return this.className="",false'>
						<div id='id4'>
							<span id='id3'>Drop a file here</span>
							<span id='id5'>or click to select one</span>
						</div>
					</div>
				</form>
			</div>
			<div class='exit' tabindex='0'></div>
			<div class='option exit' tabindex='0' id='ida'>Cancel</div>
			<div class='option disabled' tabindex='0' id='id9'>Open File</div>
		</div>
		<div id='dialog_edit_html' class='dialog'>
			<span>Edit Node as HTML</span>
			<div class='content' id='ide'>
				<textarea id='idf' spellcheck='false'></textarea>
			</div>
			<div class='exit' tabindex='0'></div>
			<div class='option exit' tabindex='0' id='idc'>Cancel</div>
			<div class='option' tabindex='0' id='idd'>Save</div>
		</div>
	</div>
	<input type='file' id='open_file' accept='text/html'>
	<script type="text/javascript">
		"use strict";
		!function(){
			window.em = function(){
				return Math.round(document.getElementById('measurementReference').getBoundingClientRect().height * (arguments.length ? +arguments[0]: 1) * 1000) / 1000 + (arguments[1] ? 'px' : 0);
			}
			window.pt = function(){
				return Math.round(document.getElementById('measurementReference').getBoundingClientRect().width * (arguments.length ? +arguments[0] : 1) * 1000) / 1000 + (arguments[1] ? 'px' : 0);
			}
			window.ContextMenu = function ContextMenu (args) {
				this.getItem = function(arg){
					for (var children = this.node.children, i = children.length - 1; i >= 0; i--) {
						if (children[i].id == this.id + '-item-' + (arg||0)) return children[i]
					}
				}
				this.node = document.createElement('ul');
				this.node.root = this.node;
				this.id = this.node.id = 'context-' + new Date().getTime().toString(36);
				this.node.className = 'contextmenu';
				this.node.style.listStyle = 'none';
				this.node.style.display = 'inline-block';
				this.node.style.position = 'absolute';
				this.node.style.left = this.node.style.top = '0';
				this.node.style.zIndex = 1000;
				for (var i = args.items.length - 1; i >= 0; i--) {
					(function(){
						var li = document.createElement('li'), image = document.createElement('div'), text = document.createElement('span'), textcontainer = document.createElement('div'), nopad = 'pad' in args.items[i] && !args.items[i].pad, itemplaceholder = args.items[i];
						li.className = 'contextmenuitem';
						li.id = this.id + '-item-' + i;
						li.root = this.node;
						var disabled = args.items[i].disabled, toggled = args.items[i].toggled || false;
						Object.defineProperties(li, {
							disabled: {
								get: function() {return disabled},
								set: function(v) {
									disabled = !!v;
									(li.children[1] || li.firstChild).style.color = v ? '#AAA' : ''
									li.title = itemplaceholder[v && itemplaceholder.disabledtitle ? 'disabledtitle' : 'title'];
								},
								enumerable: true,
								configurable: true
							},
							toggled: {
								get: function() {return toggled},
								set: function(v) {
									toggled = !!v;
									if (itemplaceholder.toggle && !nopad) (li.firstChild).style.backgroundImage = 'url("svg/' + (v ? 'checkmark' : 'transparent') + '.svg")'
								}
							}
						})
						li.func = args.items[i].func;
						// Sets image if pad is true or not included
						if (nopad) {
							li.style.width = 'calc(12rem + 1.7em)';
						} else {
							if (args.items[i].toggle) image.style.backgroundImage = args.items[i].toggled ? 'url("svg/checkmark.svg")' : 'url("https://christianfigueroa.github.io/assets/transparent.png")';
							else if (args.items[i].image) image.style.backgroundImage = 'url("' + args.items[i].image + '")';
							// Sets image styles
							image.className = 'contextmenuitemimage'
							image.style.width = '1.4em';
							image.style.height = '1.4em';
							image.style.backgroundSize = '100% 100%';
							image.style.display = 'inline-block';
							image.style.position = 'absolute';
							image.style.left = '.3em';
							image.style.top = '0em';
							image.style.pointerEvents = 'none';
							image.root = this.node;
							li.style.paddingLeft = '2.1em';
							li.appendChild(image);
						}
						textcontainer.style.width = 'auto';
						textcontainer.style.textOverflow = 'ellipsis';
						textcontainer.style.overflowX = 'hidden';
						textcontainer.style.pointerEvents = 'none';
						textcontainer.root = this.node;
						textcontainer.className = 'contextmenuitemtextcontainer';
						if (disabled) textcontainer.style.color = '#AAA';
						li.appendChild(textcontainer)
						// Sets the item's text
						text.className = 'contextmenuitemtext';
						text.innerHTML = args.items[i].name || ' ';
						text.style.pointerEvents = 'none';
						text.style.MozUserSelect = '-moz-none';
						text.style.WebkitUserSelect = 'none';
						text.style.MsUserSelect = 'none';
						text.style.userSelect = 'none';
						text.root = this.node;
						textcontainer.appendChild(text);
						// Sets the item's title if one is defined
						if (args.items[i].title && (!disabled || !args.items[i].disabledtitle)) li.title = args.items[i].title;
						else if (args.items[i].disabledtitle && disabled) li.title = args.items[i].disabledtitle;
						// Sets the item's callback function if one is defined
						if (args.items[i].func) li.addEventListener('click', function(e){
							if (!disabled) li.func.call(this,e,function(){
								li.style.background = '#F5F5F5';
								if (li.root.parentNode) li.root.parentNode.removeChild(li.root);
							})
						});
						// Sets the item's hover and click color behavior
						li.addEventListener('mouseenter', function(){
							this.style.backgroundColor = disabled ? '#E5E5E5' : '#B2EBF2';
							this.style.whiteSpace = 'pre-line';
							this.style.height = '';
							if (itemplaceholder.subcontext) {
								var context = new ContextMenu(itemplaceholder.subcontext), rect = li.getBoundingClientRect();
								context.node.parent = li;
								context.node.className += ' subcontextmenu';
								context.node.style.top = em(-.2) - 1 + 'px';
								context.node.style.left = rect.width + 'px';
								context.node.style.position = 'absolute';
								this.appendChild(context.node)
							}
						});
						li.addEventListener('mouseleave', function(e){
							this.style.backgroundColor = '';
							this.style.whiteSpace = 'nowrap';
							this.style.height = '1.4em';
							if (itemplaceholder.subcontext) {
								for (var i = this.children.length - 1; i >= 0; i--) {
									if (this.children[i].className.includes('subcontextmenu')) this.removeChild(this.children[i]);
								}
							}
						})
						li.addEventListener('mousedown', function(){this.style.backgroundColor = disabled ? '#E5E5E5' : '#A7ACEF'});
						li.addEventListener('mouseup', function(){this.style.backgroundColor = disabled ? '#E5E5E5' : '#B2EBF2'});
						li.style.padding = li.style.paddingLeft ? '.05em .4em .05em 2.1em' : '.05em .4em';
						li.style.paddingTop = '.075em';
						li.style.paddingBottom = '.025em';
						li.style.paddingRight = '.4em';
						li.style.paddingLeft = li.style.paddingLeft || '.4em';
						li.style.width = li.style.width || '12rem';
						li.style.height = li.style.minHeight = '1.4em';
						li.style.textOverflow = 'ellipsis';
						li.style.whiteSpace = 'nowrap';
						li.style.position = 'relative';
						if (args.items[i].separate) {
							li.style.marginBottom = 'calc(.2em + 1px)';
							var separator = document.createElement('div');
							separator.className = 'contextmenuitemseparator';
							separator.style.width = 'calc(12rem + 1.7em)';
							separator.style.height = '1px';
							separator.style.backgroundColor = '#C5C5C5';
							separator.style.position = 'relative';
							separator.style.top = '-.15em';
							separator.style.left = '.4em';
							this.node.insertBefore(separator, this.node.firstChild)
						}
						if (args.css) {
							for (var item in args.css) {
								li.style[item] = args.css[item];
							}
						}
						if (args.items[i].css) {
							for (var item in args.items[i].css) {
								li.style[item] = args.items[i].css[item];
							}
						}
						// Appends item to overall context menu
						this.node.insertBefore(li, this.node.firstChild);
					}).call(this)
				}
			}
		}();


		!function(){
			// Run on page load
			var iframe = document.getElementById('frame'), framewindow = iframe.contentWindow, elements = iframe.contentWindow.document.body.childNodes, overlay = document.getElementById('frameoverlay'), backdialog = document.getElementById('dialogcover'), history = {
				entries: JSON.parse(localStorage.getItem('documentHistoryEntries')) || [],
				update: function() {
					if (~this.currentEntry && framewindow.document.body.outer == this.entries[this.currentEntry].html && document.getElementById('title').value == this.entries[this.currentEntry].title) return;
					this.currentEntry += 1;
					this.entries[this.currentEntry] = {
						html: framewindow.document.body.outerHTML,
						title: document.getElementById('title').value
					}
					this.entries = this.entries.slice(0,this.currentEntry + 1);
					localStorage.setItem('documentHistoryEntries', JSON.stringify(this.entries))
					localStorage.setItem('documentHistoryCurrentEntry', this.currentEntry)
					contextmenus[3].getItem(0).disabled = !this.currentEntry;
					contextmenus[3].getItem(1).disabled = this.currentEntry == this.entries.length - 1;
				}
			}, contextmenus =
				[new ContextMenu({
					items: [{
						name: '[Node Info]',
						disabled: true,
						pad: false,
						css: {
							fontFamily: 'monospace',
							fontSize: '1.2em'
						},
						separate: true
					},{
						name: 'Edit Styles&#133;',
						title: 'Allows you to edit the element\'s CSS'
					},{
						name: 'Insert Child&#133;',
						title: 'Inserts a child node into the selected node',
						separate: true
					},{
						name: 'Edit Text',
						func: function(_,close) {
							var element = this.root.originElement, boxshadow = element.alias.style.boxShadow, blurred = 0;
							element.alias.setAttribute('contenteditable','');
							overlay.style.pointerEvents = 'none';
							element.alias.focus();
							deselect();
							element.alias.style.boxShadow = '0 0 5px 3px #00acc1';
							var pendingUpdate;
							element.alias.addEventListener('blur', function(e) {
								function temp(e){
									element.alias.dispatchEvent(new Event('blur'));
									framewindow.removeEventListener('click', temp);
									this.removeEventListener('click', temp2);
								}
								function temp2(e) {
									e.stopPropagation();
									framewindow.removeEventListener('click', temp);
									this.removeEventListener('click', temp2);
								}
								if (this.noblur) {
									// This only occurs if an HTML escape sequence replacer was clicked on
									// The contenteditable element remains contenteditable, but the user has the option to click inside the element (continue editing text, keep contenteditable), or outside the element (stop editing, take away contenteditable)
									e.preventDefault();
									this.noblur = false;
									this.focus();
									framewindow.addEventListener('click', temp);
									this.addEventListener('click', temp2);
									return;
								}
								framewindow.removeEventListener('click', temp);
								this.removeEventListener('click', temp2);
								overlay.style.pointerEvents = '';
								this.removeAttribute('contenteditable');
								element.alias.style.boxShadow = boxshadow;
								blurred = 1;
								overlayUpdate();
								history.update();
							});
							element.alias.addEventListener('dblclick', function() {
								this.dispatchEvent(new Event('blur'));
							})
							element.alias.addEventListener('keypress', function(e) {
								if ((e.keyCode == 13 || e.which == 13) && (e.ctrlKey || e.shiftKey || e.altKey)) {
									element.alias.dispatchEvent(new Event('blur'));
								};
								if (pendingUpdate) return;
								pendingUpdate = setTimeout(function() {
									pendingUpdate = 0;
									element.alias.style.boxShadow = boxshadow;
									overlayUpdate();
									if (e.isTrusted) history.update();
									if (!blurred) overlay.style.pointerEvents = 'none';
									for (var children = element.alias.childNodes,i = children.length - 1; i >= 0; i--) {
										if (i && children[i].nodeType == 3 && children[i - 1].nodeType == 3) {
											children[i - 1].textContent += children[i].textContent;
											children[i].parentNode.removeChild(children[i]);
										}
									}
									if (!blurred) {
										element.alias.alias.innerHTML = element.alias.alias.innerHTML.replace(/&(?:amp|#38);((?:[A-z]+|#\d+|#x[A-Fa-f\d]+);)/g, '<span style="border-radius:.2em;background:#00acc1;color:white;pointer-events:initial;cursor:pointer" class="html-escape-sequence-replacer" data-sequence="$&">$&</span>');
										var preelement = element;
										Array.prototype.forEach.call(document.getElementsByClassName('html-escape-sequence-replacer'), function(element) {
											var a = document.createElement('a'), sequence = element.getAttribute('data-sequence');
											a.innerHTML = sequence;
											if (a.innerText == sequence) {
												element.parentNode.removeChild(element);
												return;
											}
											if (!element.parentNode.alias) {
												!function alias (element) {
													if (!element.parentNode.parentNode.alias) alias(element.parentNode);
													var children = element.parentNode.parentNode.childNodes, index = Array.prototype.indexOf.call(children, element.parentNode);
													for (var i = index - 2; i >= 0; i--) {
														if (children[i].className == 'html-escape-sequence-replacer') {
															if (children[i + 1] && children[i + 1].className == 'html-escape-sequence-replacer') index--;
															if (children[i + 1] && children[i + 1].nodeType == 3) index--;
														} else if (children[i].nodeType == 3) {
															if (children[i + 1] && children[i + 1].className == 'html-escape-sequence-replacer') index--;
														}
													}
													element.parentNode.alias = element.parentNode.parentNode.alias.childNodes[index];
												}(element)
											};
											element.title = 'Click to replace with "' + a.innerText + '"';
											element.addEventListener('mousedown', function(e) {
												preelement.alias.noblur = true;
												var count = 0, index = Array.prototype.indexOf.call(element.parentNode.childNodes, element), origIndex = index;
												for (var children = element.parentNode.childNodes, i = index - 1; i >= 0; i--) {
													if (children[i].className == 'html-escape-sequence-replacer') {
														if (children[i + 1] && children[i + 1].className == 'html-escape-sequence-replacer') index--;
														if (children[i + 1] && children[i + 1].nodeType == 3) index--;
													} else if (children[i].nodeType == 3) {
														if (children[i + 1] && children[i + 1].className == 'html-escape-sequence-replacer') index--;
													}
												}
												for (var children = element.parentNode.childNodes, i = origIndex - 1; i >= 0; i--) {
													if (children[i].className != 'html-escape-sequence-replacer' && children[i].nodeType != 3) break;
													if (children[i].className == 'html-escape-sequence-replacer' && children[i].innerText == element.innerText) count++;
												}

												if (!element.parentNode.alias) {
													!function alias (element) {
														if (!element.parentNode.parentNode.alias) alias(element.parentNode);
														var children = element.parentNode.parentNode.childNodes, index = Array.prototype.indexOf.call(children, element.parentNode);
														for (var i = index - 2; i >= 0; i--) {
															if (children[i].className == 'html-escape-sequence-replacer') {
																if (children[i + 1] && children[i + 1].className == 'html-escape-sequence-replacer') index--;
																if (children[i + 1] && children[i + 1].nodeType == 3) index--;
															} else if (children[i].nodeType == 3) {
																if (children[i + 1] && children[i + 1].className == 'html-escape-sequence-replacer') index--;
															}
														}
														element.parentNode.alias = element.parentNode.parentNode.alias.childNodes[index];
													}(element)
												}
												element.parentNode.alias.childNodes[index].textContent = element.parentNode.alias.childNodes[index].textContent.replace(new RegExp('((?:.*?(?=' + sequence + ')' + sequence + '){' + count + '}.*?(?=' + sequence + '))' + sequence + '(.*$)'), function(_,$1,$2){
													return $1 + a.innerText + $2;
												});
												element.parentNode.alias.dispatchEvent(new Event('keypress'));
												element.parentNode.replaceChild(document.createTextNode(a.innerText), element);
											})
										})
									}
									element.alias.style.boxShadow = blurred ? boxshadow : '0 0 5px 3px #00acc1';
								}, 10)
							});
							element.alias.dispatchEvent(new Event('keypress'));
							close();
						},
						title: 'Allows you to edit the element\'s textual content'
					},{
						name: 'Edit as HTML&#133;',
						image: 'svg/edit_as_html.svg',
						func: function(_,close) {
							close();
							closeHeaders();
							backdialog.style.display = 'block';
							document.getElementById('dialog_edit_html').style.display = 'block';
							document.getElementById('idf').value = this.root.originElement.alias[(this.root.originElement.alias == framewindow.document.body ? 'inn' : 'out')+ 'erHTML'];
							document.getElementById('idf').linkedElement = this.root.originElement.alias;
						},
						title: 'Allows you to edit the node\'s HTML',
						separate: true
					},{
						name: 'Delete Node',
						func: function(_,close) {
							this.root.originElement.alias.parentNode.removeChild(this.root.originElement.alias);
							overlayUpdate();
							history.update();
							close();
						},
						title: 'Removes node from the document',
						disabledtitle: 'This node cannot be removed from the document'
					}]
				}),
				new ContextMenu({
					items: [{
						name: 'Delete Nodes',
						func: function(_,close) {
							var elements = document.querySelectorAll('[data-selected-element=selected]');
							for (var i = elements.length - 1; i >= 0; i--) {
								if (elements[i].alias.parentNode && elements[i].alias != framewindow.document.body) elements[i].alias.parentNode.removeChild(elements[i].alias);
							}
							overlayUpdate();
							history.update();
							close();
						}
					}]
				}),
				new ContextMenu({
					items: [{
						name: 'New',
						disabled: true,
						disabledtitle: 'Work in Progress'
					},{
						name: 'Open&#133;',
						func: function(_,close) {
							document.getElementById('dialogcover').style.display = 'block';
							document.getElementById('dialog_open_file').style.display = 'block';
							document.getElementById('id2').innerHTML = '<div id="id1" ondragover="return this.className=\'active\',false" ondragend="return this.className=\'\',false" ondragleave="return this.className=\'\',false"><div id="id4"><span id="id3">Drop a file here</span><span id="id5">or click to select one</span></div></div>';
							document.getElementById('idb').scrollTop = 0;
							document.getElementById('id9').className = 'option disabled';
							document.getElementById('id1').addEventListener('drop', function(e) {
								e.preventDefault();
								e.stopPropagation();
								this.className='';
								if (!e.dataTransfer.files.length) return;
								document.getElementById('id4').innerHTML = '<div id="id6"><div id="id7">' + (e.dataTransfer.files[0].name) + '<span style="float:right">' + (e.dataTransfer.files[0].size < 1000 ? e.dataTransfer.files[0].size + ' bytes' : Math.round(e.dataTransfer.files[0].size / 100) / 10 + 'KB') + '</span></div><span id="id8"></span></div>';
								if (e.dataTransfer.files[0].type != 'text/html') return document.getElementById('id8').innerHTML = 'This file format is not allowed. Please only select an HTML file ending in an ".html" extension.',document.getElementById('id7').style.background = '#FFB7B7',document.getElementById('id9').className='option disabled';
								document.getElementById('id7').style.background = '#A6FFA6';
								document.getElementById('id8').innerHTML = 'Make sure your work is saved before pressing "Open File"';
								document.getElementById('id9').className = 'option';
								document.getElementById('id2').file = e.dataTransfer.files[0];
							});
							close();
							closeHeaders();
						},
						title: 'Open an HTML file to replace the current document'
					},{
						name: 'Download File&#133;',
						disabled: true,
						disabledtitle: 'Work in Progress'
					}]
				}),
				new ContextMenu({
					items: [{
						name: 'Undo',
						func: undo,
						title: 'Reverts most recent change',
						disabledtitle: 'There are no changes to be undone'
					},{
						name: 'Redo',
						func: redo,
						title: 'Restores most recent change',
						disabledtitle: 'There are no changes to be redone',
						separate: true
					},{
						name: 'Select all',
						func: function(_,close) {
							var elements = document.querySelectorAll('#frameoverlay *,#frameoverlay');
							for (var elements = document.querySelectorAll('#frameoverlay, #frameoverlay *'), i = elements.length - 1; i >= 0; i--) {
								elements[i].setAttribute('data-selected-element', 'selected');
								close();
								closeHeaders();
								document.getElementById('tooltiptext').innerHTML = elements.length + ' nodes selected'
							}
						},
						title: 'Selects all nodes in the document'
					},{
						name: 'Select none',
						func: function(_,close) {
							deselect();
							close();
							closeHeaders();
							document.getElementById('tooltiptext').innerHTML = 'Extra information will appear here'},
						title: 'Deselects all nodes in the document'
					}]
				}),
				new ContextMenu({
					items: [{
						name: 'Toolbar',
						disabled: true,
						disabledtitle: 'Work in Progress'
					},{
						name: 'Full Page',
						disabled: true,
						disabledtitle: 'Work in Progress'
					},{
						name: 'HTML Tree',
						disabled: true,
						disabledtitle: 'Work in Progress',
						separate: true
					},{
						name: 'Grid',
						func: function(_,close) {
							this.toggled = !this.toggled;
							if (this.toggled) document.getElementById('overlaygrid').style.display = 'block';
							else document.getElementById('overlaygrid').style.display = '';
							close();
							closeHeaders();
						},
						title: 'Toggles the overlay grid for the document',
						toggle: true
					}]
				})];
			console.log(history)
			history.currentEntry = +localStorage.getItem('documentHistoryCurrentEntry') || history.entries.length - 1
			console.log(history)
			if (history.entries.length) {
				framewindow.document.body.outerHTML = history.entries[history.currentEntry].html;
				document.getElementById('title').value = history.entries[history.currentEntry].title;
				framewindow.document.body.style.margin = framewindow.document.body.style.margin || '0';
			} else {
				framewindow.document.body.innerHTML = 'This is the <span style="color: #00acc1; font-family: monospace;">&lt;<span>body</span>&gt;</span> element.<div>And this a <span style="color: #00acc1; font-family: monospace;">&lt;div&gt;</span> element.</div><div>Try clicking on elements<br>to select them</div>';
				framewindow.document.body.style.background = 'white';
				framewindow.document.body.style.textAlign = 'center';
				framewindow.document.body.style.fontSize = '1.5em';
				framewindow.document.body.style.fontFamily = 'Arial, sans-serif';
				framewindow.document.body.style.margin = '0';
				framewindow.document.documentElement.style.overflowY = framewindow.document.body.style.overflowY = 'hidden';
			}
			framewindow.document.head.appendChild(framewindow.document.createElement('title'));
			contextmenus[3].getItem(0).disabled = !history.currentEntry;
			contextmenus[3].getItem(1).disabled = history.currentEntry == history.entries.length - 1;
			overlay.alias = framewindow.document.body;


			// Overlay event listeners
			overlay.addEventListener('contextmenu', function(e){
				e.preventDefault();
				e.stopPropagation();
				var index = document.querySelectorAll('[data-selected-element=selected]').length > 1 ? 1 : 0;
				if (!index) overlay.dispatchEvent(new Event('click'));
				if (e.target.className.includes('contextmenu')) document.body.removeChild(document.getElementsByClassName('contextmenu')[0]);
				if (!index) contextmenus[index].getItem(0).firstChild.firstChild.innerHTML = '<span style="color:#33F">body</span>' + (framewindow.document.body.id ? '<span style="color:#009"><wbr>#' + framewindow.document.body.id + '</span>' : '') + (framewindow.document.body.className ? '<span style="color:#F44"><wbr>.' + framewindow.document.body.className.replace(/\s+/g,'<wbr>.') + '</span>' : '');
				if (!index) contextmenus[index].getItem(5).disabled = true;
				document.body.appendChild(contextmenus[index].node);
				var style = contextmenus[index].node.getBoundingClientRect();
				contextmenus[index].node.style.left = e.clientX - (style.width + e.clientX > window.innerWidth ? style.width - window.innerWidth + e.clientX : 0) + 'px';
				contextmenus[index].node.style.top = e.clientY - (style.height + e.clientY > window.innerHeight ? style.height - window.innerHeight + e.clientY : 0) - em() + 'px';
				contextmenus[index].node.originElement = overlay;
			});
			overlay.addEventListener('click', function(e) {
				e.stopPropagation();
				if (e.shiftKey) {
					overlay.style.background = 'rgba(0,0,0,0)';
					overlay.setAttribute('data-selected-element', overlay.getAttribute('data-selected-element') != 'selected' ? 'selected' : '');
					var nodes = document.querySelectorAll('[data-selected-element=selected]');
					if (nodes.length>1) document.getElementById('tooltiptext').innerHTML = nodes.length + ' nodes selected';
					else if (nodes[0]) document.getElementById('tooltiptext').innerHTML = '<span style="font-family:monospace;font-size:1.15em"><span style="color:#33f">' + nodes[0].alias.nodeName.toLowerCase() + '</span>' + (nodes[0].alias.id ? '<span style="color:#009">#' + nodes[0].alias.id + '</span>' : '') + (nodes[0].alias.className ? '<span style="color:#F44">.' + nodes[0].alias.className.replace(/\s+/g,'.') + '</span>' : '') + '</span>';
					else document.getElementById('tooltiptext').innerHTML = 'Extra information will appear here';
				} else {
					overlay.style.background = 'rgba(0,0,0,0)';
					var selected = overlay.getAttribute('data-selected-element') == 'selected';
					deselect();
					overlay.setAttribute('data-selected-element', document.querySelectorAll('[data-selected-element=selected]').length > 1 || !e.isTrusted ? 'selected' : selected ? '' : 'selected');
					if (selected) document.getElementById('tooltiptext').innerHTML = 'Extra information will appear here';
					else document.getElementById('tooltiptext').innerHTML = '<span style="font-family:monospace;font-size:1.15em"><span style="color:#33f">' + overlay.alias.nodeName.toLowerCase() + '</span>' + (overlay.alias.id ? '<span style="color:#009">#' + overlay.alias.id + '</span>' : '') + (overlay.alias.className ? '<span style="color:#F44">.' + overlay.alias.className.replace(/\s+/g,'.') + '</span>' : '') + '</span>';
				}
				if (document.selection) document.selection.empty(),iframewindow.document.selection.empty();
				else if (getSelection) getSelection().removeAllRanges(),framewindow.getSelection().removeAllRanges();
			});
			overlay.addEventListener('mousemove', function(e) {
				document.getElementById('tooltiptext').innerHTML = '(' + (e.offsetX || e.clientX) + ', ' + (e.clientY - Math.floor(document.getElementById('toolbarcontainer').getBoundingClientRect().height) + document.getElementById('framecontainer').scrollTop) + ')';
			});
			overlay.addEventListener('mouseleave', function() {
				document.getElementById('tooltiptext').innerHTML = 'Extra information will appear here'
			})



			// Function to update overlay to match iframe
			function overlayUpdate () {
				if (!document.getElementById('frame').contentWindow.document.body) {
					var doc = document.getElementById('frame').contentWindow.document, body = doc.createElement('body');
					doc.documentElement.appendChild(body);
					document.getElementById('frameoverlay').alias = body;
					body.innerHTML = 'The <span style="color: #00acc1; font-family: monospace;">&lt;body&gt;</span> element should not be deleted.<br>All content in the document should be kept as children of the <span>&lt;body&gt;</span> element.';
					body.style.margin = '0';
					body.style.textAlign = 'center';
					body.style.fontFamily = 'Arial, sans-serif';
					body.style.background = 'white';
					body.style.fontSize = '1.5em';
				}
				var elements = framewindow.document.body.childNodes, overlay = document.getElementById('frameoverlay');
				framewindow.document.body.alias = overlay;
				overlay.innerHTML = '';
				for (var i = elements.length - 1; i >= 0; i--) {
					function clone (parent) {
						var clonednode = this.cloneNode();
						this.alias = clonednode;
						clonednode.alias = this;
						if (clonednode instanceof Element || clonednode.nodeType == 1) {

							// On right click pseudo element
							clonednode.addEventListener('contextmenu', function(e){
								e.preventDefault();
								e.stopPropagation();
								var index = document.querySelectorAll('[data-selected-element=selected]').length > 1 ? 1 : 0;
								if (!index) clonednode.dispatchEvent(new Event('click'));
								if (e.target.className.includes('contextmenu')) document.body.removeChild(document.getElementsByClassName('contextmenu')[0]);
								if (!index) contextmenus[index].getItem(0).firstChild.firstChild.innerHTML = '<span style="color:#33F">' + clonednode.nodeName.toLowerCase() + '</span>' + (clonednode.alias.id ? '<span style="color:#009"><wbr>#' + clonednode.alias.id + '</span>' : '') + (clonednode.alias.className ? '<span style="color:#F44"><wbr>.' + clonednode.alias.className.replace(/\s+/g,'<wbr>.') + '</span>' : '');
								if (!index) contextmenus[index].getItem(5).disabled = false;
								document.body.appendChild(contextmenus[index].node);
								var style = contextmenus[index].node.getBoundingClientRect();
								contextmenus[index].node.style.left = e.clientX - (style.width + e.clientX > window.innerWidth ? style.width - window.innerWidth + e.clientX : 0) + 'px';
								contextmenus[index].node.style.top = e.clientY - (style.height + e.clientY > window.innerHeight ? style.height - window.innerHeight + e.clientY : 0) - em() + 'px';
								contextmenus[index].node.originElement = clonednode
							});

							// On left click pseudo element
							clonednode.addEventListener('click', function(e) {
								e.stopPropagation();
								if (e.shiftKey) {
									clonednode.style.background = 'rgba(0,0,0,0)';
									clonednode.setAttribute('data-selected-element', clonednode.getAttribute('data-selected-element') != 'selected' ? 'selected' : '');
									var nodes = document.querySelectorAll('[data-selected-element=selected]');
									if (nodes.length>1) document.getElementById('tooltiptext').innerHTML = nodes.length + ' nodes selected';
									else if (nodes[0]) document.getElementById('tooltiptext').innerHTML = '<span style="font-family:monospace;font-size:1.15em"><span style="color:#33f">' + nodes[0].alias.nodeName.toLowerCase() + '</span>' + (nodes[0].alias.id ? '<span style="color:#009">#' + nodes[0].alias.id + '</span>' : '') + (nodes[0].alias.className ? '<span style="color:#F44">.' + nodes[0].alias.className.replace(/\s+/g,'.') + '</span>' : '') + '</span>';
									else document.getElementById('tooltiptext').innerHTML = 'Extra information will appear here';
								} else {
									clonednode.style.background = 'rgba(0,0,0,0)';
									var selected = clonednode.getAttribute('data-selected-element') == 'selected';
									deselect();
									clonednode.setAttribute('data-selected-element', document.querySelectorAll('[data-selected-element=selected]').length > 1 || !e.isTrusted ? 'selected' : selected ? '' : 'selected');
									if (selected) document.getElementById('tooltiptext').innerHTML = 'Extra information will appear here';
									else document.getElementById('tooltiptext').innerHTML = '<span style="font-family:monospace;font-size:1.15em"><span style="color:#33f">' + clonednode.alias.nodeName.toLowerCase() + '</span>' + (clonednode.alias.id ? '<span style="color:#009">#' + clonednode.alias.id + '</span>' : '') + (clonednode.alias.className ? '<span style="color:#F44">.' + clonednode.alias.className.replace(/\s+/g,'.') + '</span>' : '') + '</span>';
								}
								if (document.selection) document.selection.empty(),iframewindow.document.selection.empty();
								else if (getSelection) getSelection().removeAllRanges(),framewindow.getSelection().removeAllRanges();
							})
							clonednode.style.cursor = 'crosshair';
							clonednode.style.color = 'rgba(0,0,0,0)';
							clonednode.style.background = 'rgba(0,0,0,0)';

							clonednode.setAttribute('style', clonednode.getAttribute('style').replace(/(\d+)vw/g, function($_, $1) {
								return framewindow.innerWidth / 100 * $1 + 'px';
							}).replace(/(\d+)vh/g, function($_, $1) {
								return framewindow.innerHeight / 100 * $1 + 'px';
							}))
						}
						parent.insertBefore(clonednode, parent.firstChild);
						if (this.childNodes.length) {
							for (var i = this.childNodes.length - 1; i >= 0; i--) {
								clone.call(this.childNodes[i], clonednode)
							}
						}
					};
					clone.call(elements[i],overlay);
				}
				var styles = framewindow.document.body.style;
				for (var style in styles) {
					try {
						overlay.style[style] = framewindow.document.body.style[style];
					} catch (_) {}
				};
				overlay.style.cursor = 'crosshair';
				overlay.style.color = 'rgba(0,0,0,0)';
				overlay.style.background = 'rgba(0,0,0,0)';
				document.getElementById('overlaygrid').style.height = document.getElementById('frameback').style.height = iframe.style.height = overlay.getBoundingClientRect().height + 'px';
			}


			// Deselects all elements and set their background back to transparent
			function deselect () {
				Array.prototype.forEach.call(document.querySelectorAll('[data-selected-element=selected]'), function(element) {
					element.setAttribute('data-selected-element','');
					element.style.background = 'rgba(0,0,0,0)';
				})
			}


			var sectionopen = false;
			Array.prototype.forEach.call(document.getElementsByClassName('headersection'), function(element,index,array){
				element.addEventListener('mousedown', function (e){
					e.stopPropagation();
					sectionopen = !sectionopen;
					if (sectionopen) {
						dispatchEvent(new MouseEvent('mousedown'));
						document.body.appendChild(contextmenus[index + 2].node);
						contextmenus[index + 2].node.style.left = this.getBoundingClientRect().left + 'px';
						contextmenus[index + 2].node.style.top = this.getBoundingClientRect().bottom - em() + 'px';
						this.style.background = '#DDD';
					} else {
						document.body.removeChild(contextmenus[index + 2].node);
						this.style.background = '';
					};
					setTimeout(function(){
						if (document.selection) document.selection.empty();
						else if (getSelection) getSelection().removeAllRanges();
					},0)
				});

				element.addEventListener('mouseenter', function (){
					if (!sectionopen) return;
					Array.prototype.forEach.call(array, function(element, index) {
						element.style.background = '';
						try{
							document.body.removeChild(contextmenus[index + 2].node);
						}catch(_){}
					});
					dispatchEvent(new MouseEvent('mousedown'));
					document.body.appendChild(contextmenus[index + 2].node);
					contextmenus[index + 2].node.style.left = this.getBoundingClientRect().left + 'px';
					contextmenus[index + 2].node.style.top = this.getBoundingClientRect().bottom - em() + 'px';
					this.style.background = '#DDD';
				});
			});
			function closeHeaders() {
				Array.prototype.forEach.call(document.getElementsByClassName('headersection'), function(element) {
					sectionopen = false;
					contextmenus.forEach(function(context) {
						if (context.parentNode == document.body) document.body.removeChild(context.node);
					});
					element.style.background = '';
				})
			}

			document.getElementById('title').addEventListener('keypress', function(e) {
				if (e.keyCode == 13) return this.blur();
				setTimeout(function(){
					if (!this.value) this.style.fontStyle = 'italic';
					else this.style.fontStyle = '';
					var width = document.getElementById('titlewidth');
					width.innerText = this.value;
					document.getElementById('title').style.width = width.scrollWidth + em(.6) + 'px';
					document.title = (this.value || 'HTML Studio') + ' \xb7 ChristianFigueroa.GitHub.io';
					framewindow.document.querySelector('title').innerText = this.value;
				}.bind(this),0);
			});

			document.getElementById('title').addEventListener('blur', function(){
				history.update();
				if (!this.value) this.style.fontStyle = 'italic';
				else this.style.fontStyle = '';
			});
			document.getElementById('title').dispatchEvent(new Event('keypress'));



			function closeDialogs() {
				document.getElementById('dialogcover').style.display = '';
				Array.prototype.forEach.call(document.getElementsByClassName('dialog'), function(element) {
					element.style.display = '';
				})
			};

			// Dialog option button event listeners
			// Event listener for file upload window
			document.getElementById('open_file').addEventListener('change', function(e) {
				if (!this.files.length) return;
				document.getElementById('id4').innerHTML = '<div id="id6"><div id="id7">' + (this.files[0].name) + '<span style="float:right">' + (this.files[0].size < 1000 ? e.files[0].size + ' bytes' : Math.round(this.files[0].size / 100) / 10 + 'KB') + '</span></div><span id="id8"></span></div>';
				if (this.files[0].type != 'text/html') return document.getElementById('id8').innerHTML = 'This file format is not allowed. Please only select an HTML file ending in an ".html" extension.',document.getElementById('id7').style.background = '#FFB7B7',document.getElementById('id9').className='option disabled';
				document.getElementById('id7').style.background = '#A6FFA6';
				document.getElementById('id8').innerHTML = 'Make sure your work is saved before pressing "Open File"';
				document.getElementById('id9').className='option';
				document.getElementById('id2').file = this.files[0];
			});
			// Onclick event listener for file uploader for File > Open...
			document.getElementById('id2').addEventListener('click', function() {
				document.getElementById('open_file').click();
			});
			// Open File button for File > Open...
			document.getElementById('id9').addEventListener('click', function() {
				if (this.className.includes('disabled')) return;
				var reader = new FileReader(), html;
				reader.onload = function() {
					try {
						html = reader.result;
						var template = document.createElement('template'), tempiframe = document.createElement('iframe'), body;
						template.innerHTML = html;
						if (!template.content.querySelector('body')) {
							try {
								body = new DOMParser().parseFromString(html, 'text/html').body;
							} catch (_) {
								body = new DOMParser().parseFromString(html, 'text/xml');
								if (body.children[0].nodeName == 'parsererror') throw Error('The file could not be read as HTML (Update or change your browser!) and was interpretted as malformed XML. Try removing <script> elements or updating/changing your browser to be interpretted correctly.');
								body = body.getElementsByTagName('body')[0]
							}
						} else body = template.content.querySelector('body');
						if (!body) throw Error('A <body> element could not be found or the file is malformed. Try updating/changing your browser.');
						localStorage.setItem('documentHistoryEntries', JSON.stringify([{
							html: (body).outerHTML,
							title: (template.content.querySelector('title') || {innerText:''}).innerText
						}]));
						localStorage.setItem('documentHistoryCurrentEntry', 0);
						closeDialogs();
						location.reload();
					} catch(_) {
						console.error(_);
						document.getElementById('id8').innerHTML = 'An error occurred while parsing the file. Make sure the file is valid HTML (and includes a &lt;body&gt;) or try another browser.'
					}
				}
				reader.readAsText(document.getElementById('id2').file);
			});
			// Save HTML button for [Right Click] > Edit as HTML...
			document.getElementById('idd').addEventListener('click', function() {
				var textarea = document.getElementById('idf'), template = document.createElement('template');
				if (textarea.linkedElement == framewindow.document.body) {
					return framewindow.document.body.innerHTML = textarea.value,closeDialogs(),overlayUpdate(),history.update();
				}
				template.innerHTML = textarea.value;
				var children = template.content.childNodes;
				for (var i = children.length - 1; i >= 0; i--) {
					textarea.linkedElement.parentNode.insertBefore(children[i], i == children.length - 1 ? textarea.linkedElement.nextSibling : children[i + 1]);
				}
				textarea.linkedElement.parentNode.removeChild(textarea.linkedElement);
				overlayUpdate();
				history.update();
				closeDialogs();
			})
			// Top right exit button event listener
			Array.prototype.forEach.call(document.getElementsByClassName('exit'), function(element) {
				element.addEventListener('click', function() {
					if (!this.className.includes('disabled')) closeDialogs();
				})
			})



			window.addEventListener('mousedown',function(e){
				if (!document.getElementsByClassName('contextmenu')[0] || (e.target.className && e.target.className.includes('contextmenu'))) return;
				document.body.removeChild(document.getElementsByClassName('contextmenu')[0] || {});
				if (sectionopen) {
					Array.prototype.forEach.call(document.getElementsByClassName('headersection'), function(element, index) {
						element.style.background = '';
					});
					sectionopen = false;
				}
			});

			function undo () {
				history.currentEntry = Math.max(history.currentEntry - 1, 0);
				framewindow.document.body.outerHTML = history.entries[history.currentEntry].html;
				var title = document.getElementById('title');
				title.value = history.entries[history.currentEntry].title;
				if (!title.value) title.style.fontStyle = 'italic';
				else title.style.fontStyle = '';
				overlayUpdate();
				localStorage.setItem('documentHistoryCurrentEntry', history.currentEntry);
				contextmenus[3].getItem(0).disabled = !history.currentEntry;
				contextmenus[3].getItem(1).disabled = history.currentEntry == history.entries.length - 1;
				deselect();
			}
			function redo () {
				history.currentEntry = Math.min(history.currentEntry + 1, history.entries.length - 1);
				framewindow.document.body.outerHTML = history.entries[history.currentEntry].html;
				var title = document.getElementById('title');
				title.value = history.entries[history.currentEntry].title;
				title.value = history.entries[history.currentEntry].title;
				if (!title.value) title.style.fontStyle = 'italic';
				else title.style.fontStyle = '';
				overlayUpdate();
				localStorage.setItem('documentHistoryCurrentEntry', history.currentEntry);
				contextmenus[3].getItem(1).disabled = history.currentEntry == history.entries.length - 1;
				contextmenus[3].getItem(0).disabled = !history.currentEntry;
				deselect();
			}
			function windowkeypress(e) {
				if (e.charCode == 122 && e.ctrlKey) undo();
				else if (e.charCode == 121 && e.ctrlKey) redo();
			}
			window.addEventListener('keypress', windowkeypress);
			framewindow.addEventListener('keypress', windowkeypress);


			// Main interval
			var currentFrame = 0;
			setInterval(function() {
				currentFrame = (currentFrame + 1) % 50;
				var opacity = -Math.abs(currentFrame - 25) + 25, bgcolor = 'rgb(' + opacity * 2 + ',' + Math.round(opacity * 2 + 172) + ',' + Math.round(opacity * 2 + 193) +')', tcolor = 'rgb(' + Math.round((-opacity + 25) * 2.55 + 191) + ',' + Math.round((-opacity + 25) * 2.55 + 191) + ',' + Math.round((-opacity + 25) * 2.55 + 191) +')';
				Array.prototype.forEach.call(document.querySelectorAll('[data-selected-element=selected]'), function(element) {
					element.style.backgroundColor = 'rgba(0,172,193,'+(.006*opacity+.15)+')';
				});
				Array.prototype.forEach.call(document.getElementsByClassName('html-escape-sequence-replacer'), function(element) {
					//element.style.backgroundColor = bgcolor;
					element.style.color = tcolor;
				});
			}, 20);


			overlayUpdate();
			history.update();
		}();
	</script>
</body>
</html>
